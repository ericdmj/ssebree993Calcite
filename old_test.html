<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>CALCITE Walkthrough</title>

    <!-- Load hosted version CDN Calcite -->
    <script type="module" src="https://js.arcgis.com/calcite-components/2.13.0/calcite.esm.js"></script>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/calcite-components/2.13.0/calcite.css" />

    <script src="https://js.arcgis.com/4.30/"></script>
    <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/css/main.css" />
    
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      body {
      display: flex;
      }
      #header-title {
        margin-left: 1rem;
        margin-right: 1rem;
      }
    </style>
  </head>
  <body>
    <calcite-shell content-behind>
      <calcite-loader></calcite-loader>
      <h2 id="header-title" slot="header">
        <!-- Populated at runtime -->
      </h2>
      <calcite-shell-panel slot="panel-start" display-mode="float">
        <calcite-action-bar slot="action-bar">
          <calcite-action data-action-id="layers" icon="layers" text="Layers"></calcite-action>
        </calcite-action-bar>
        <calcite-panel heading="Layers" data-panel-id="layers" hidden>
          <div id="layers-container"></div>
        </calcite-panel>
      </calcite-shell-panel>
      <div id="viewDiv"></div>
    </calcite-shell>

    <script>
      require(["esri/config"], (esriConfig) => {
        esriConfig.apiKey = "AAPKfc7af196c6e64aac988bbf7529dccd648UR6aqr1HCuaJ5GN7OXourF3WZ9GF_b8R9-mMcrEZMHlZzpuLXHwt5iwInOA9k4J";
      });

      require(["esri/views/MapView", "esri/WebMap", "esri/widgets/LayerList"], (MapView, WebMap, LayerList) => {
        const webmap = new WebMap({
          portalItem: {
            id: "f2e9b762544945f390ca4ac3671cfa72"
          }
        });

        const view = new MapView({
          map: webmap,
          container: "viewDiv"
        });

        view.ui.move("zoom", "top-left");

        const layerList = new LayerList({
          view: view,
          selectionEnabled: true,
          visibilityAppearance: "checkbox",
          container: "layers-container"
        });

        webmap.when(() => {
          const title = webmap.portalItem.title;
          document.getElementById("header-title").textContent = title;
        });

        let activeWidget;

      });

      // Handle the click event on the action bar
      const handleActionBarClick = (event) => {
        const target = event.target;
        if (target.tagName !== "CALCITE-ACTION") {
          return;
        }

        if (activeWidget) {
          document.querySelector(`[data-action-id=${activeWidget}]`).active = false;
          document.querySelector(`[data-panel-id=${activeWidget}]`).hidden = true;
        }

        const nextWidget = target.dataset.actionId;
        if (nextWidget !== activeWidget) {
          document.querySelector(`[data-action-id=${nextWidget}]`).active = true;
          document.querySelector(`[data-panel-id=${nextWidget}]`).hidden = false;
          activeWidget = nextWidget;
        } else {
          activeWidget = null;
        }
      };

      // Add event listener to the action bar
      document.querySelector("calcite-action-bar").addEventListener("click", handleActionBarClick);
    </script>
  </body>
</html>
